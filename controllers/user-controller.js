"use strict";
const models_1 = require("../models");
const userController = {
    async getAllUsers(req, res) {
        try {
            const users = await models_1.User.find({});
            res.json(users);
        }
        catch (err) {
            if (err)
                throw err;
        }
    },
    async getUser({ params }, res) {
        try {
            const user = await models_1.User.findById(params.id);
            if (!user) {
                res.status(404).send(`User Not Found`);
                return;
            }
            res.json(user);
        }
        catch (err) {
            if (err)
                throw err;
        }
    },
    async createUser({ body }, res) {
        try {
            const newUser = await models_1.User.create(body);
            res.status(201).send(`User ${newUser.username} created`);
        }
        catch (err) {
            if (err)
                throw err;
        }
    },
    async updateUser({ params, body }, res) {
        try {
            const user = await models_1.User.findByIdAndUpdate(params.id, body);
            if (!user) {
                res.status(404).send(`User Not Found`);
                return;
            }
            res.status(200).send(`User ${user} updated`);
        }
        catch (err) {
            if (err)
                throw err;
        }
    },
    async deleteUser({ params }, res) {
        try {
            const user = await models_1.User.findById(params.id);
            user.thoughts.map(async (thought) => {
                await models_1.Thoughts.findByIdAndDelete(thought);
            });
            const deletedUser = await models_1.User.findByIdAndDelete(params.id);
            res.status(200).send(`User #${params.id} deleted`);
        }
        catch (err) {
            if (err)
                throw err;
        }
    },
    async addFriend({ params }, res) {
        try {
            const user = await models_1.User.findById(params.id);
            user.friends.push(params.friendId);
            user.save();
            res.status(200).send(`Friend Removed`);
        }
        catch (err) { }
    },
    async removeFriend({ params }, res) {
        try {
            const user = await models_1.User.findByIdAndUpdate(params.id, {
                $pull: { friends: params.friendId },
            });
            res.status(200).send(`Friend Removed`);
        }
        catch (err) { }
    },
};
module.exports = userController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1jb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbnRyb2xsZXJzL3VzZXItY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsc0NBQTJDO0FBRTNDLE1BQU0sY0FBYyxHQUFHO0lBRXJCLEtBQUssQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUc7UUFDeEIsSUFBSTtZQUNGLE1BQU0sS0FBSyxHQUFHLE1BQU0sYUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNsQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2pCO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFDWixJQUFJLEdBQUc7Z0JBQUUsTUFBTSxHQUFHLENBQUM7U0FDcEI7SUFDSCxDQUFDO0lBR0QsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFLE1BQU0sRUFBRSxFQUFFLEdBQUc7UUFDM0IsSUFBSTtZQUNGLE1BQU0sSUFBSSxHQUFHLE1BQU0sYUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDNUMsSUFBSSxDQUFDLElBQUksRUFBRTtnQkFDVCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUN2QyxPQUFPO2FBQ1I7WUFDRCxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2hCO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFDWixJQUFJLEdBQUc7Z0JBQUUsTUFBTSxHQUFHLENBQUM7U0FDcEI7SUFDSCxDQUFDO0lBR0QsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEdBQUc7UUFDNUIsSUFBSTtZQUNGLE1BQU0sT0FBTyxHQUFHLE1BQU0sYUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN4QyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLE9BQU8sQ0FBQyxRQUFRLFVBQVUsQ0FBQyxDQUFDO1NBQzFEO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFDWixJQUFJLEdBQUc7Z0JBQUUsTUFBTSxHQUFHLENBQUM7U0FDcEI7SUFDSCxDQUFDO0lBR0QsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxHQUFHO1FBQ3BDLElBQUk7WUFDRixNQUFNLElBQUksR0FBRyxNQUFNLGFBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzNELElBQUksQ0FBQyxJQUFJLEVBQUU7Z0JBQ1QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDdkMsT0FBTzthQUNSO1lBQ0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLFVBQVUsQ0FBQyxDQUFDO1NBQzlDO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFDWixJQUFJLEdBQUc7Z0JBQUUsTUFBTSxHQUFHLENBQUM7U0FDcEI7SUFDSCxDQUFDO0lBR0QsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxFQUFFLEdBQUc7UUFDOUIsSUFBSTtZQUNGLE1BQU0sSUFBSSxHQUFHLE1BQU0sYUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDNUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxFQUFFO2dCQUNsQyxNQUFNLGlCQUFRLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDNUMsQ0FBQyxDQUFDLENBQUM7WUFDSCxNQUFNLFdBQVcsR0FBRyxNQUFNLGFBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDNUQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxNQUFNLENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQztTQUNwRDtRQUFDLE9BQU8sR0FBRyxFQUFFO1lBQ1osSUFBSSxHQUFHO2dCQUFFLE1BQU0sR0FBRyxDQUFDO1NBQ3BCO0lBQ0gsQ0FBQztJQUdELEtBQUssQ0FBQyxTQUFTLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFHO1FBQzdCLElBQUk7WUFDRixNQUFNLElBQUksR0FBRyxNQUFNLGFBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzVDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNuQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDWixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1NBQ3hDO1FBQUMsT0FBTyxHQUFHLEVBQUUsR0FBRTtJQUNsQixDQUFDO0lBR0QsS0FBSyxDQUFDLFlBQVksQ0FBQyxFQUFFLE1BQU0sRUFBRSxFQUFFLEdBQUc7UUFDaEMsSUFBSTtZQUNGLE1BQU0sSUFBSSxHQUFHLE1BQU0sYUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUU7Z0JBQ25ELEtBQUssRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsUUFBUSxFQUFFO2FBQ3BDLENBQUMsQ0FBQztZQUNILEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7U0FDeEM7UUFBQyxPQUFPLEdBQUcsRUFBRSxHQUFFO0lBQ2xCLENBQUM7Q0FDRixDQUFDO0FBRUYsaUJBQVMsY0FBYyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGhvdWdodHMsIFVzZXIgfSBmcm9tIFwiLi4vbW9kZWxzXCI7XHJcblxyXG5jb25zdCB1c2VyQ29udHJvbGxlciA9IHtcclxuICAvLyBnZXQgYWxsIHVzZXJzIGRhdGFcclxuICBhc3luYyBnZXRBbGxVc2VycyhyZXEsIHJlcykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBVc2VyLmZpbmQoe30pO1xyXG4gICAgICByZXMuanNvbih1c2Vycyk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgaWYgKGVycikgdGhyb3cgZXJyO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vIGdldCBzaW5nbGUgdXNlciBkYXRhIGZyb20gaWRcclxuICBhc3luYyBnZXRVc2VyKHsgcGFyYW1zIH0sIHJlcykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQocGFyYW1zLmlkKTtcclxuICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg0MDQpLnNlbmQoYFVzZXIgTm90IEZvdW5kYCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHJlcy5qc29uKHVzZXIpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGlmIChlcnIpIHRocm93IGVycjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBjcmVhdGUgbmV3IHVzZXJcclxuICBhc3luYyBjcmVhdGVVc2VyKHsgYm9keSB9LCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG5ld1VzZXIgPSBhd2FpdCBVc2VyLmNyZWF0ZShib2R5KTtcclxuICAgICAgcmVzLnN0YXR1cygyMDEpLnNlbmQoYFVzZXIgJHtuZXdVc2VyLnVzZXJuYW1lfSBjcmVhdGVkYCk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgaWYgKGVycikgdGhyb3cgZXJyO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vIHVwZGF0ZSB1c2VyIGRhdGFcclxuICBhc3luYyB1cGRhdGVVc2VyKHsgcGFyYW1zLCBib2R5IH0sIHJlcykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUocGFyYW1zLmlkLCBib2R5KTtcclxuICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg0MDQpLnNlbmQoYFVzZXIgTm90IEZvdW5kYCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKGBVc2VyICR7dXNlcn0gdXBkYXRlZGApO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGlmIChlcnIpIHRocm93IGVycjtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICAvLyBkZWxldGUgdXNlciBkYXRhXHJcbiAgYXN5bmMgZGVsZXRlVXNlcih7IHBhcmFtcyB9LCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHBhcmFtcy5pZCk7XHJcbiAgICAgIHVzZXIudGhvdWdodHMubWFwKGFzeW5jICh0aG91Z2h0KSA9PiB7XHJcbiAgICAgICAgYXdhaXQgVGhvdWdodHMuZmluZEJ5SWRBbmREZWxldGUodGhvdWdodCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBjb25zdCBkZWxldGVkVXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWRBbmREZWxldGUocGFyYW1zLmlkKTtcclxuICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoYFVzZXIgIyR7cGFyYW1zLmlkfSBkZWxldGVkYCk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgaWYgKGVycikgdGhyb3cgZXJyO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIC8vIGFkZCBmcmllbmRcclxuICBhc3luYyBhZGRGcmllbmQoeyBwYXJhbXMgfSwgcmVzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChwYXJhbXMuaWQpO1xyXG4gICAgICB1c2VyLmZyaWVuZHMucHVzaChwYXJhbXMuZnJpZW5kSWQpO1xyXG4gICAgICB1c2VyLnNhdmUoKTtcclxuICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoYEZyaWVuZCBSZW1vdmVkYCk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHt9XHJcbiAgfSxcclxuXHJcbiAgLy8gcmVtb3ZlIGZyaWVuZFxyXG4gIGFzeW5jIHJlbW92ZUZyaWVuZCh7IHBhcmFtcyB9LCByZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKHBhcmFtcy5pZCwge1xyXG4gICAgICAgICRwdWxsOiB7IGZyaWVuZHM6IHBhcmFtcy5mcmllbmRJZCB9LFxyXG4gICAgICB9KTtcclxuICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoYEZyaWVuZCBSZW1vdmVkYCk7XHJcbiAgICB9IGNhdGNoIChlcnIpIHt9XHJcbiAgfSxcclxufTtcclxuXHJcbmV4cG9ydCA9IHVzZXJDb250cm9sbGVyO1xyXG4iXX0=